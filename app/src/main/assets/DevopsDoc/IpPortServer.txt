///////////////////	Home ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Name						IP						Domain					Web/Port/Type
lab-server					192.168.55.10			server.devops.com		todolist:8080/Vuejs:nginx		shoeshop
git-db-registry-server		192.168.55.20			gitlab.devops.com		gitlab:80						database:3306				registry:5000
jenkins-server				192.168.55.30			jenkins.devops.com		jenkins:8080
///////////////////	Company	//////////////////////////////////////////////////////////////////
Name						IP						Domain					Web/Port/Type
lab-server					192.168.56.10			server.devops.com		todolist:2001/Vuejs:nginx			vision:3000/React:service			shoeshop:8090/Spring:
																			todolist:5555/Vuejs:docker			vision:4444/React:docker			shoeshop:7777-6666/Spring:docker
database-server				192.168.56.20:3306		database.devops.com
gitlab-server				192.168.56.30			gitlab.devops.com
registry-server				192.168.56.40:5000		registry.devops.com
jenkins						192.168.56.50			jenkins.devops.com
zabbix-server				192.168.56.60
desktop						192.168.56.100

k8s-70-server				192.168.56.70
k8s-80-server				192.168.56.80
k8s-90-server				192.168.56.90
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
ssh ngocnm@192.168.1.
192.168.1.10 server.devops.com
192.168.1.20 gitlab.devops.com
192.168.1.30 jenkins.devops.com
192.168.56.60 dev-server
192.168.56.50 k8s-worker
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
ssh ngocnm@192.168.56.
192.168.56.10 server.devops.com
192.168.56.20 database.devops.com
192.168.56.30 gitlab.devops.com
192.168.56.40 registry.devops.com
192.168.56.50 jenkins.devops.com

192.168.56.70 k8s-70-server
192.168.56.80 k8s-80-server
192.168.56.90 k8s-90-server
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
1. Project: Envinroment: deployment - staging - prodction
2. Devops:
	- Setup Envinroment: 
		+ Servers: 					Linux, nginx, connection between servers [dev-server, gitlab-server, database-server], ph√¢n quy·ªÅn user / security
		+ Setup Manage project: 	Gitlab, Jenkins, Travis, Circle
		+ CI/CD:					build -> test: 	pef, security, clean code, unit test, pin test ...
									run: 			deploy
3. Monitoring:
	- Internet:
		+ ping 8.8.8.8	 				= ping google.com
		+ telnet IP port				check connect to other server
		+ traceroute -T -p port IP	 	check port open or not (-T = tcp connection, -p = port)
	- Ram/Cpu usage:
		+ free -m	: ram usage
		+ df -h / 	: cpu usage
		+ top		: task manager
	- Check logs:
		+ tail -n 5000 logFile
		+ grep keyWord logFile
	- set time zone:
		+ sudo timedatectl set-timezone Asia/Ho_Chi_Minh			sudo dpkg-reconfigure tzdata
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
0. Virtualbox VM: 				
	+ shared folder:		E:\VMWare\SharedFolder
		- VM -> Setting -> SharedFolder -> New -> Select E:\VMWare\SharedFolder -> Mount point: /mnt/shared-folder or /home/user/shared-folder 	 & 		Select: Auto mount & Make Permanent
		- VM:		sudo mount -t vboxsf SharedFolder /mnt/shared-folder
		- Host: 	copy file to E:\VMWare\SharedFolder		-> ls /mnt/shared-folder
		- VM:		cp filePath /mnt/shared-folder			-> F5 E:\VMWare\SharedFolder
	+ shared folder VMWare:
		- VM setting -> ennable shared folder	-> 	add folder: D:\DevOps\VMWare\SharedFolder
		- Menu -> Edit -> Preferences: Enable all shared foldes by default
		- sudo apt-get install open-vm-tools
		- mkdir /mnt/shared-folder 		->		sudo /usr/bin/vmhgfs-fuse .host:/SharedFolder /mnt/shared-folder
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
1. Project
	- install dependencies / tools for project (run & deploy)
	- set chmod, chowner for user & project
	- frontend:	Vue/React:	
		+ install packages: 		sudo apt install nodejs nginx npm -y
		+ install dependencies:		npm install
		+ deploy:												
			- build:				npm run build	 (folder: dist / build)						npm run start/server	
			- run:					
				+ webserver:		nginx		-> config: /etc/nginx/conf.d/xxx.conf			working: /usr/share/nginx/html/		-> apply: systemctl restart nginx / nginx -s reload
														server {
															listen 		8081; // port
															root 		/projects/todolist/dist/; // build folder
															index 		index.html;
															try_files	$uri $uri/ /index.html;
														}
				+ service:			systemctl	-> config: /lib/systemd/system/xxx.service		-> apply: systemctl daemon-reload /	systemctl restart vision (.service)	
														[Service]
														Type=simple
														User=vision
														Restart=on-failure
														WorkingDirectory=/projects/vision/
														ExecStart=npm run start -- --port=3000
	- backend:
		+ Java Spring:	
			- install java, maven, database:	apt install openjdk-17-jdk openjdk-17-jre maven -y [mariadb-server]
			- deploy:							build:	mvn install -DskipTest=true		/		run:	nohup java -jar target/shoe-ShoppingCart-0.0.1-SNAPSHOT.jar 2>&1 &
			- config port:						server.port=8090								// project/src/main/resource/application.properties
/////////////////////////////////////////////////////////////////////////////////////
2. Database:	database-server
	- install: 		apt install mariadb-server -y
	- config:		/etc/mysql/mariadb.conf.d/xx_server.cnf		-> 		bind-address = 0.0.0.0		-> systemctl stop/restart mariadb
	- create db:	mysql -u root	-->		create database dbName; create user 'uName'@'%' indentified by 'pass'; 
											grant all privileges on dbName.* to 'uName'@'%'; flush privileges; exit
	- connect db:	mysql -h IP	-P 3306 -u uName -p 	-> enper password		-> use dbName; source db-file-path; // import db
	// gitlab-server
	- config db for project:		project/src/main/resource/application.properties
		- spring.datasource.url=jdbc:mysql://<address_server>:<port>/<database_name>//?useSSL=false
		- spring.datasource.username=<username>
		- spring.datasource.password=<password>
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
3. Gitlab: gitlab-server
	- gitlab-ee:
		+ install: 		google
			- offline:		dpkg -i gitlab-ee_14.4.1-ee.0_amd64.deb
			- config: 		/etc/gitlab/gitlab.rb		-> external_url: gitlab domain	->		gitlab-ctl reconfigure
			- add hosts:	/etc/hosts					/windows hosts					-> 		add for gitlab-server & other server
		+ admin:		manage group/user/project
		+ project:	
			- config:	protected branch, runner, add variables, tags, pipeline, graph ...
			- create: 	branch/commit/merge request/
		
		+ gitlab secret: ...
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
4. Registry server: docker registry-server
	+ public: 			dockerhub
	+ harbor registry: 	harbor							-> manage users, docker [projects, images, and list tags of image] 		->		authenticate by 
	+ private registry: self authentication by openssl	(any user, any pass)
		- install openssl:				apt install openssl -y			mkdir -p /tools/docker/registry/certs & data
		- gen key by openssl:			cd /tools/docker/registry/		openssl req -newkey rsa:4096 -nodes -sha256 -keyout certs/domain.key -subj "/CN=192.168.1.10" -addext "subjectAltName=DNS:192.168.1.10,IP:192.168.1.10" -x509 -days 3650 -out certs/domain.crt
		- install docker-compose: 		apt install docker-compose
		- write docker-compose.yml:		cd /tools/docker/registry/		nano docker-compose.yml		--> 	run: docker-compose up -d
			version: '3'
			services:
				registry:
					image: registry:2
					restart: always
					container_name: registry-server
					ports:
						- "5000:5000"
					volumes:
						- ./data:/var/lib/registry
						- ./certs:/certs
					environment:
						REGISTRY_HTTP_TLS_CERTIFICATE: certs/domain.crt
						REGISTRY_HTTP_TLS_KEY: certs/domain.key
				web:
					image: nginx:alpine
					ports:
						- "8000:80"
					volumes:
						- ./app:/usr/share/nginx/html
		- check:
			+ docker-compose ps							// list docker-compose running
			+ 192.168.56.10:5000/v2/_catalog:			// list images on registry									// registry-domain/v2/_catalog ~ registry.devops.com/v2/_catalog
			+ 192.168.56.10:5000/v2/image/tags/list:	// list tags of image on registry
		- *** copy cert to any client using registry & add hosts:	mkdir -p /etc/docker/certs.d/192.168.56.40:5000		----	cp 	/tools/docker/registry/certs/domain.crt /etc/docker/certs.d/192.168.56.40:5000/ca.crt
				cp /mnt/shared-folder/ca.crt /etc/docker/certs.d/192.168.56.40:5000/ca.crt		// for shared-folder
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
5. Jenkins server:
	+ install jenkins:		create file: /tools/jenkins/jenkins-install.sh				-> 		run: chmod +x ../jenkins-install.sh (cap quyen execute)				sh/bash ../jenkins-install.sh
		- add hosts & reverse proxy:	nginx 	& 	nano /etc/nginx/conf.d/jenkins.devops.com.conf	 ---	
				server { listen 80; server_name jenkins.devops.com; location / { proxy_pass http://jenkins.devops.com:8000; } }
	
	+ connect jenkins-server vs lab-server: 	by Jenkins Agent
		- lab-server:		install java version same jenkins: apt install openjdk-17-jdk / adduser jenkins	/ add jenkinsFolder: /var/lib/jenkins [clone code from gitlab / build / run]
							-> chown -R jenkins:jenkins /var/lib/jenkins	/ NOPASSWD: visudo for user jenkins
		- jenkins-server:	add Node [Number of executors 3/4 -- Remote root directory: jenkinsFolder from lab-server] [Add fixed port]	 -> save ->	show command to connect lab-server	-> node not run
		- lab-server:		su jenkins	-	cd /var/lib/jenkins		-> run commands with secret-file + nohup -> jenkinsFolder: save agent.jar / secret-file
							java -jar agent.jar -url http://jenkins.devops.com:8080/ -secret @secret-file -name "lab-server-node" -webSocket -workDir "/var/lib/jenkins/" > nohup.out 2>&1 &	-> node start running
							////
							make service for auto start jenkins-agent: 			nano /lib/systemd/system/jenkins-agent.service		-> 		systemctl daemon-reload		->		systemctl start jenkins-agent
								[Unit]
								Description=Jenkins Agent Service
								After=network.target								# run service sau khi network dc thiet lap xong
								[Service]
								Type=simple
								WorkingDirectory=/var/lib/jenkins
								ExecStart=/bin/bash -c 'java -jar agent.jar -url http://jenkins.devops.com:8080/ -secret @secret-file -name "lab-server-node" -webSocket -workDir "/var/lib/jenkins/"'		# command to run jenkins-agent
								User=jenkins
								Restart=always										# auto restart if it is stopped								
								[Install]
								WantedBy=multi-user.target							# can run by multi-user
	
	+ connect jenkins-server vs gitlab-server:	by plugin Gitlab, BlueOcen
		- gitlab-server:	create user jenkins - admin role		-> 	login by user jenkins		->		Profile: Access Token scope API
		- jenkins-server:	
			+ install plugin: 			[Gitlab, BlueOcen] -> System -> Gitlab: set name - domain - add API token [Domain: Global  -  Kind: API token  -  Scope: Global/System  -  ID: jenkins-gitlab-user] -> Add -> Test
			+ create token webhooks:	Account -> Security -> API token: add new token							// 1175600b85cccd7a9dbdf938e4587282a9 - used to add gitlab webhooks
	
	+ Script: 	
		- script c√≥ import lib th√¨ lib ƒë√≥ c·∫ßn ƒëc approve trong "Script Approval", apply t·ª´ng d√≤ng 1 n√™n c·∫ßn run script & F5 li√™n t·ª•c page:  http://jenkins.devops.com/manage/scriptApproval/ 		// n√™n test script trong "Script console" tr∆∞·ªõc khi ƒë∆∞a v√†o pipeline
	
	+ check log:	By default logs should be made available in /var/log/jenkins/jenkins.log, unless customized in /etc/default/jenkins (for *.deb) or via /etc/sysconfig/jenkins (for */rpm)
		- java -jar /usr/share/java/jenkins.war			// fail
		- journalctl -u jenkins.service					// search key
		- config:	systemctl edit jenkins				// failed: file is not edited			//	[Service]	Environment="JENKINS_LOG=%L/jenkins/jenkins.log"
	
	+ config:		/etc/default/jenkins	-> PORT, LOGS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
6. Deploy servers: lab-server, sub-server, ...												nohub java -jar /run/shoeshop/shoe-ShoppingCart-0.0.1-SNAPSHOT.jar > nohub.out 2>&1 &
	+ add hosts for gitlab-server, jenkins-server, lab-server, registry-server
	
	+ Gitlab CI/CD: 		using gitlab-runner
		- lab-server: install gitlab-runner
			+ online:	curl -L "https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh" | sudo bash	/	apt install gitlab-runner
			+ offline:	curl -LJO "https://gitlab-runner-downloads.s3.amazonaws.com/latest/deb/gitlab-runner_amd64.deb"		/	 curl -LJO "https://gitlab-runner-downloads.s3.amazonaws.com/latest/deb/gitlab-runner-helper-images.deb"
						dpkg -i gitlab-runner-helper-images.deb gitlab-runner_amd64.deb
			+ config:	/etc/gitlab-runner/config.toml		-> 		edit concurrent = 4
						visudo								->		gitlab-runner ALL=(ALL:ALL) NOPASSWD: /bin/cp*-chmod*-su shoeshop*			// for using other user to run CI/CD
			+ gitlab-runner register -> gitlab domain, token (on gitlab-server/project setting), runner name, executor=shell/docker/...
			+ gitlab-runner run --working-directory /home/gitlab-runner --config ../config.toml --service gitlab-runner --user gitlab-runner > nohup.out 2>&1 &	-> gitlab-runner list	// run = multiple >< run-single
			+ type: gitlab-runner-shell/docker		/		/home/gitlab-runner/xxx/project: [clone project from gitlab -> build -> run: copy *jar file to other folder "/datas/shoeshop/" & run]
		
		- gitlab-server:	develop for gitlab-runner-shell		/		staging for gitlab-runner-docker
			+ .gitlab-ci.yml: 	creater project/.gitlab-ci.yml	-> stages: [jobs] / variables: [vars] / stage: job / when: manual / script: [commands] / tag: runner-name / only: tags/branch
				- build stage: 	clone project from gitlab-server to lab-server with path: /home/gitlab-runner/builds/AZxtpzuE/0/shoeshopgroup/shoeshop 
								-> build folder: /target/ with user [gitlab-runner] on lab-server
				- deploy stage:	should use other user and folder for run/deploy project [user: shoeshop, folder: /datas/shoeshop/] -> c·∫ßn copy file, c·∫•p quy·ªÅn rwx folder cho user
			+ CI with docker:	
				- usermod -aG docker gitlab-runner					// add group docker for user gitlab-runner, ƒë·ªÉ gitlab c√≥ th·ªÉ run docker
				- add variables: REGISTRY_URL / PROJECT / USER / PASSWORD								REGISTRY_URL = 192.168.56.40:5000		// protected variables only for protected branches
				- create project/Dockerfile:		-> 
					+ build:	[FROM build-alpine:ver as build]										[WORKDIR /app	COPY . .] 	[RUN build-command]	
					+ run:		[FROM alpine:ver	RUN run-envr-command]								[WORKDIR /run	COPY --from=build /target/image  /run/image]		
								[RUN adduser -D uName 		RUN chmod -R uName	 	User uName]			[EXPOSE containerPort]				[ENV xxx]
								[ENTRYPOINT run-command]												CMD ["command", "params", ""]		// run-command = java -jar /run/shoeshop/shoe-ShoppingCart-0.0.1-SNAPSHOT.jar
				- .gitlab-ci.yml:
					+ build:
						- before_script:	docker login registry-server -u user -p password
						- script:		 	docker build -t image . 	/		docker push image			// image format: domain/project/image:tag_commit
					+ run:
						- before_script:	docker login registry-server -u user -p password
						- script:		 	docker pull image	 		/		docker run --name containerName -dp serverPort:containerPort image		/ adduser & roles
											// docker run container: success = logs: Tomcat started on port(s): 8080 (http)		 						8080 = container port, neu da set port server truoc, Tomcat se start tren port do
					+ showlog:
						- script:			docker logs $DOCKER_CONTAINER
				- Notes:
					+ voi docker: 	connect toi database nen dung IP, dung domain co the bi loi "java.net.UnknownHostException: database.devops.com: Name does not resolve"
									docker run da co config -dp (run in background) roi nen trong Dockerfile ko can run backgroud nua (nohup)
	
	+ Jenkins CI/CDeployment:	need Jenkinsfile in project src code
		- lab-server: 		if node/jenkins-agent is not running: 	cd /var/lib/jenkins -> su jenkins -> java -jar agent.jar -url http://jenkins.devops.com:8080/ -secret @secret-file -name "lab-server-node" -webSocket -workDir "/var/lib/jenkins/" > nohup.out 2>&1 &	-> node start running
							-> make service for auto start jenkins-agent: 			nano /lib/systemd/system/jenkins-agent.service		-> 		systemctl daemon-reload		->		systemctl start jenkins-agent

		- jenkins-server:	create Folder & Pipeline of Folder & create token for user jenkins (n√™n t·∫°o user ri√™ng cho project - ngocnm, token dung tren gitlab)
			+ Folder:		Dashboard -> New Item -> Action-in-lab-server [Type: Folder]
			+ Pipeline:		Dashboard -> Action-in-lab-server -> New Item -> Pipeline: name shoeshop	
							-> config:	[Discard old builds: Max build to keep / Gitlab connection: gitlab-server / Build trigger: Events push-merge / Pipeline: Pipeline script from SCM [SCM: Git / Script Path: Jenkinsfile] ]
							-> config:  -> SCM: Git [Repo Url: http://gitlab.devops.tech/group/shoeshop.git  / Credentials: new Jenkins [user-gitlab: jenkins, pass: password / Branches to build: add branches ]
			+ Token:		Account -> Security -> API token: add new token							// 1175600b85cccd7a9dbdf938e4587282a9 - used to add gitlab webhooks
		
		- gitlab-server:	
			+ Allow Webhooks:	Admin Setting -> Network -> Outbound request:  Allow requests to the local network from webhooks and integrations -> Save
			+ Add Webhooks:	Project Setting -> Webhooks: [URL:  http://<user jenkins>:<token webhooks user jenkins>@<domain jenkins>/project/<path of project on jenkins>]	// http://user:token@jenkins.devops.com/project/Action-in-lab/shoeshop
			+ Add Jenkinsfile for project: groovy syntax
					pipeline {
						agent { label 'lab-server-node-label'}
						environment { appUser = "shoeshop"	/ appName / appversion / appType / processName / folderDeploy / folderBackup / folderMain / buildScript / copyScript / permsScript / killScript / runScript / ... }
						stages {
							stage('job-action') {
								steps {
									sh(script: """ whoami; pwd; ls -la; ${buildScript} """, label: "show info")
									script {
										try {
											if (evn.userChoice == 'yes') { sh(script: """ ${deployScript} """, label: "deploy app") } else { echo "xxx"}
										} catch (Exception ex) { echo "Deploy Exception: $ex" }
									}
								}
							}
							stage('job-n') {} ....
						}
					}
			+ CI with Docker:
				- lab-server: 		usermod -aG docker jenkins
				- jenkins-server:	add variables [REGISTRY_URL, REGISTRY_PROJECT, REGISTRY_USER, REGISTRY_PASS]
				- gitlab-server:	
					+ Dockerfile:	same above
					+ Jenkinsfile:
							
		- lab-server: Running on lab-server-node in /var/lib/jenkins/workspace/Action-in-lab-server/shoeshop
	
	+ Jenkins CI/CDelivery: 	totaly manual for prod environment
		- lab-server: 		run jenkins-agent by service as CI/CDeployment
		- gitlab-server:	not need allow Webhooks & Jenkinsfile as CI/CDeployment					// webhooks need declare working folder like: Action-in-lab-server/shoeshop and need Jenkinsfile in project src code
		- jenkins-server:	typing scripts as below with option "Use Groovy Sandbox"
			+ Create new folder for prod:	Dashboard -> New Item -> Action-in-prod [Type: Folder]
			+ Create pipeline for prod:		Dashboard -> Action-in-prod  -> New Item -> shoeshop [Type: Pipeline]	
				-> config: [Discard old builds: Max # of builds to keep / GitLab Connection: This project is parameterized -> add params scripts / Pipeline: Pipeline script ] -> Branches to build: branch is added by commit hash in step checkout src code from commit hash in Pipeline script
				- script select server						// Active choice parameters					// name: server				script: return ['lab-server-node', 'lab-server-node-name-1', 'lab-server-node-name-2'] - array
				- script select action						// Active choice parameters					// name: action				script: return ['start', 'stop', 'upcode', 'rollback] - array
				- string parameters							// for git commit hash to clone code		// name: hash
				- script rollback							// Active choice Reactive parameters		// name: rollback_version	script: [create backup folder / run folder]		[backup=zip run folder -> copy .zip to backup folder]	[rollback=unzip file to run folder]
			+ pipeline scripts:		params.[server/hash/action/rollback_version]				-> get value from params scripts
					appUser = "shoeshop"	/ appName / appversion / appType / processName / folderDeploy / folderBackup / folderMain / buildScript / copyScript / permsScript / killScript / runScript / ... 		// declare variables
					
					def methodName() {		// def startProcess()		def stopProcess()		def upcodeProcess()		def backupProcess()		def rollbackProcess()
						def pId = sh(returnStdout:true, script: """ pgrep -f ${processName} """, label: "get pId")
						stage('jobName') { if (pId == "") {sh(script: """ sudo kill -9 ${pId} """, label: "kill process"} else { echo "pId null" } ... }
						stage('jobName-2') {} ....
					}
					
					node(params.server) { 	// get correct node for each lab-server by server-node-name, not using node label
						currentAction = params.action
						if (params.action == 'rollback') {
							backupProcess()
							stopProcess()
							rollbackProcess()
							startProcess()
						}
						....
					}
		- lab-server: Running on lab-server-node in /var/lib/jenkins/workspace/Action-in-prod/shoeshop
	
	** Deploy result:
		+ Gitlab CI/CD: auto/manual by [when:manual/always 		only: -tags]
			- normal:			server.port=8888													http://192.168.56.10:8888					develop					// server.port=8888 in application.properties
			- docker:			server.port=9999				container.port=8080					http://192.168.56.10:9999					staging					// -dp 9000:8081
		+ Jenkins CI/CD:
			// auto: 	CDeployment
			- normal:			server.port=8000													http://192.168.56.10:8000					main					// server.port=8000 in application.properties
			- docker: 			server.port=9000				container.port=8081					http://192.168.56.10:9000					docker_deployment		// -dp 9000:8081
			// manual:	CDelivery
			- prod:				server.port=7000													http://192.168.56.10:7000					production				// server.port=7000 in application.properties
			- prod_docker:		server.port=6000				container.port=8082					http://192.168.56.10:6000					prod_docker				// -dp 9000:8082

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
7. Docker: on lab-server
	- install: apt install docker-ce									sh install-docker.sh
	- docker  login url / pull domain/project/image:tag / 				start containerName / stop / rm / rmi / logs / ps / push domani/project/image:tag
	- docker build -t domani/project/image:tag -f Dockerfile			-> build image
	- docker run --name name -dp 8080:80 -it image:tag					// 8080:80 = server-port:container-port
	
	- Dockerfile:	create new Dockerfile in ../project/
		+ Build:	FROM build-alpine:ver as build			WORKDIR /app							COPY . .							RUN cmd_build
		+ Run:		FROM run-alpine:ver						WORKDIR /run		RUN cmd_user		COPY --from=build /src /target		Run	cmd_run				ENTRYPOINT cmd_run
		+ EVN, EXPOSE, USER
	- docker-compose: 	docker-compose up -d docker-compose.yml			docker-compose ps
	
	- Docker component:
		+ Docker volume
		+ Docker compose
		+ Docker network
		
	- docker system prune: clear stop container / all network not using / dangling images / unused build cache
	
	- Tip security / optimize:
		+ non root user:				-> for security
		+ ch·ªçn base image ph√π h·ª£p:		->
			- ƒë√∫ng version /Java 8 		-> n√™n c√†i maven java 8 ƒë·ªÉ build & run: t·ªëi ∆∞u dung l∆∞·ª£ng docker image build ra & h·∫°n ch·∫ø tools ko c·∫ßn thi·∫øt l√†m tƒÉng size
			- ubuntu/cenos				-> n√™n ch·ªçn image ƒëc build s·∫µn d·ª±a tr√™n alpine v√¨ nh·∫π v√† t·ªëi ∆∞u - ho·∫∑c image slime
			- base image uy t√≠n			-> n√™n ch·ªçn : offical / verified / sponsored
			- tool qu√©t image			-> check l·ªó h·ªïng
			
			- build: clean cached
		+ use Multiple stage: 			-> gi·∫£m size docker image cu·ªëi c√πng ƒëc build ra
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
8. Monitoring
	+ Zabbix
//////  KUBERNETES  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
9. Kubernetes
	9.1. Component:
		+ Cluster:		[master nodes - worker nodes]											// nhi·ªÅu node, 1 master - n worker 	><	n master - n worker
			- Node:		[ ns1: [pod1.1, pod1.2, ...] 	ns2[pod2.1 pod2.2] 	... ]				// ns = name space
			- Master node:
				+ namespace:	
					- default, kube-system, kube-public, kube-node-lease						// when create node done: kubeadm init --address_server 192.168.56.70
					- cattle-system																// when import k8s to rancher
				// Pods
				+ Pod:	[1container		volumes]												// user pod
				+ etcd																			// pod in ns kube-system		name: etcd-k8s-70-master
				+ kube-apiserver																// pod in ns kube-system		name: kube-apiserver-k8s-70-master
				+ kube-scheduler																// pod in ns kube-system		name: kube-scheduler-k8s-70-master
				+ kube-controller-manager														// pod in ns kube-system		name: kube-controller-manager-k8s-70-master
				+ kube-cloud-manager															// pod in ns kube-system				
				// dns
				+ coredns-xxxx-yyy																// pod in ns cattle-system
				
				// Network
				+ calico-node-xxxx																// pod in ns kube-system		bao nhi√™u node trong cluster th√¨ c√≥ b·∫•y nhi√™u pod calico
				+ kube-proxy-xxxx																// pod in ns kube-system		bao nhi√™u node trong cluster th√¨ c√≥ b·∫•y nhi√™u pod proxy
				+ calico-kube-controllers-xxx													// pod in ns kube-system
				// Rancher
				+ cattle-cluster-agent-xxx														// pod in ns cattle-system		rancher agent -> need pull image rancher:v2.9.2 -> maybe got ImagePullBackOff error
				+ rancher-webhook
				+ rancher-provisioning-capi
			- Worker node:
				+ Pod
				+ kubelet
				+ kube-proxy
	9.2. Command
		+ kubeadm:
		+ kubectl:
			- kubectl logs car-serv-pod -n car-serv-ns
			- kubectl get events --all-namespaces  --sort-by='.metadata.creationTimestamp'
			- kubectl get events pod car-serv-pod -n car-serv-ns
			- kubectl describe pod car-serv-pod -n car-serv-ns
		+ kubelet:
	9.3. Fix error
		+ init k8s in master node:				- node is not ready	-> apply calico.yaml		- init wrong node ip -> init kem ip & set ip for each node in: 
		+ worker node joined to master node:	- node is not ready	-> apply calico.yaml		
		+ import k8s to rancher:				- cluster still pending	-> agent got error		- ImagePullBackOff / ContainerCreating
		+ Created new pod:						- pod still ContainerCreating -> 				// kubectl get events --all-namespaces  --sort-by='.metadata.creationTimestamp'		
			- Failed to pull image "elroydevops/car-serv:latest" / ImagePullBackOff / ContainerCreating / ErrImagePull: by cert error /  tls: failed to verify certificate: x509: certificate signed by unknown authority
			- Failed to create pod sandbox: rpc error 
			- Fix cert:
				+ 1. Copy *cert, *.key  in /etc/kubernets/pki/ to /usr/local/share/ca-certificates/		-> sudo update-ca-certificates
				+ 2. Systemctl restart containerd
			- Fix pulling image failed:
				+ 
				
		+ using privare registry:
			// 1. create secret for single privare registry
			- kubectl create secret docker-registry dockersecret-name --docker-server=192.168.56.40:5000 --docker-username=ngocnm --docker-password=admin 		// --docker-email=<your-email>
					containers:		// pod.yaml
					- name: ...
					imagePullSecrets:
					- name: dockersecret-name
				+ kubectl get secret dockersecret-name --output=yaml				kubectl describe secret dockersecret-name			kubectl edit/delete secrets <secret-name>
				+ kubectl get secret dockersecret-name --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode	 // {"auths":{"192.168.56.40:5000":{"username":"ngocnm","password":"admin","auth":"bmdvY25tOmFkbWlu"}}}
				// Add image pull secret to service account
				- kubectl patch serviceaccount default -p '{"imagePullSecrets": [{"name": "dockersecret-name"}]}'			// ~ kubectl edit serviceaccount/default
			// 2. Adding insecure registry in containerd
			- sudo nano /etc/containerd/config.toml
					[plugins."io.containerd.grpc.v1.cri".registry.configs]
					  [plugins."io.containerd.grpc.v1.cri".registry.configs."192.168.56.40:5000"]
						[plugins."io.containerd.grpc.v1.cri".registry.configs."192.168.56.40:5000".tls]
						  ca_file = ""
						  cert_file = ""
						  insecure_skip_verify = true
						  key_file = ""

					[plugins."io.containerd.grpc.v1.cri".registry.mirrors]	
					  [plugins."io.containerd.grpc.v1.cri".registry.mirrors."192.168.56.40:5000"]
						endpoint = ["https://192.168.56.40:5000"]
			
			- sudo systemctl restart containerd
			- crictl -r unix:///var/run/containerd/containerd.sock 192.168.56.40:5000/			// test
			
			// 3. Specifying ImagePullSecrets on a Pod.
			- edit rancger-import.yaml:	image: 192.168.56.40:5000/rancher/rancher-agent:v2.9.2 			// from:	curl --insecure -sfL https://192.168.56.100/v3/import/2ddvphht4x77pt89kjcj6gh5766xt622c8lkxm58b5zssm8c7bfdvl_c-m-ggg7x598.yaml
			// check secret on worker node
			- kubectl -n kube-system exec -it etcd-k8s-70-master ls -l /etc/kubernetes/pki/etcd
			
			// 4. add insecure registry for docker on rancher server
			- nano /etc/docker/daemon.json
				{
				  "insecure-registries": ["192.168.56.40::5000"]
				}
			- systemctl restart docker
		
		// Rancher	
		+ Failed to install system chart rancher-provisioning-capi: pod cattle-system/helm-operation-trb86 failed, watch closed
		+ Failed to install system chart rancher-webhook: pod cattle-system/helm-operation-gzk49 failed, watch closed
		+ Internal error occurred: failed calling webhook "rancher.cattle.io.clusters.management.cattle.io": no endpoints available for service "rancher-webhook"
		//////////		kubectl  --namespace kube-system get configmap kubeadm-config -o yaml
		"--cluster-cidr=192.168.0.0/16"
		 networking:
		  dnsDomain: cluster.local
		  podSubnet: 192.168.0.0/16
		  serviceSubnet: 10.96.0.0/12
		
		+ rancher-webhooks: expiration cert
			- kubectl get validatingwebhookconfiguration rancher.cattle.io -o yaml > vwc-rancher.cattle.io.yaml
			- kubectl get mutatingwebhookconfiguration rancher.cattle.io -o yaml > mwc-rancher.cattle.io.yaml
			- kubectl delete validatingwebhookconfiguration rancher.cattle.io
			- kubectl delete mutatingwebhookconfiguration rancher.cattle.io
			
			- kubectl apply -f vwc-rancher.cattle.io.yaml
			- kubectl apply -f mwc-rancher.cattle.io.yaml
		+ 
		// cert
		+ sudo dpkg-reconfigure ca-certificates
		openssl x509 -inform DER -in certificate.cer -out certificate.crt
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

C·∫§U TR√öC POD.YAML TRONG KUBERNETES

appversion: v1 					‚Üí LO·∫†I API C·ª¶A T√ÄI NGUY√äN (

kind: pod 						‚Üí LO·∫†I T√ÄI NGUY√äN (POD)

metadata:
	name: techops-pod 			‚Üí T√™n duy nh·∫•t c·ªßa Pod
	abels: 						‚Üí Nh√£n ƒë·ªÉ t·ªï ch·ª©c v√† ch·ªçn Podapp: techops ‚Üí Nh√£n ·ª©ng d·ª•ng, h·ªØu √≠ch cho b·ªô ch·ªçn (selectors)
		tier: backend 			‚Üí X√°c ƒë·ªãnh l·ªõp ·ª©ng d·ª•ng

spec:
	containers: 				‚Üí CONTAINER(S) CH·∫†Y TRONG POD N√ÄY
	- name: techops-container 	‚Üí T√™n c·ªßa container
	  image: nginx:1.23 		‚Üí Docker image cho container
	  ports:
	  - containerPort: 80 		‚Üí C·ªïng m√† container m·ªü n·ªôi b·ªô
	  env:
	  - name: ENV
	    value: production 		‚Üí Bi·∫øn m√¥i tr∆∞·ªùng ƒë·ªÉ c·∫•u h√¨nh
	  volumeMounts: 			‚Üí C√ÅC VOLUMES ƒê∆Ø·ª¢C G·∫ÆN V√ÄO TRONG CONTAINER
	  - name: config-volume 	‚Üí Volume ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong ph·∫ßn ‚Äúvolumes‚Äù
		mountPath: /usr/share/nginx/html 	‚Üí ƒêi·ªÉm g·∫Øn k·∫øt (mount point) b√™n trong container

	volumes:
	- name: config-volume 		‚Üí T√™n c·ªßa volume
	  configMap:
	    name: techops-config	‚Üí S·ª≠ d·ª•ng ConfigMap l√†m ngu·ªìn v√† tham chi·∫øu ƒë·∫øn ConfigMap c√≥ t√™n ‚Äútechops-config‚Äù
	  
	RESTARTPOLICY: ALWAYS 		‚Üí CH√çNH S√ÅCH KH·ªûI ƒê·ªòNG L·∫†I POD (ALWAYS, ONFAILURE HO·∫∂C NEVER)

	NODESELECTOR: 				‚Üí L·ªäCH TR√åNH (SCHEDULE) POD TR√äN C√ÅC NODE C·ª§ TH·ªÇ
	  disktype: ssd 			‚Üí Ch·ªâ ch·∫°y tr√™n c√°c node c√≥ nh√£n ‚Äúdisktype=ssd‚Äù

	TOLERATIONS: 				‚Üí CHO PH√âP L√äN L·ªäCH TR√äN C√ÅC NODE B·ªä "TAINT"
	- key: "special-taint" 		‚Üí Kh√≥a taint c·∫ßn ch·∫•p nh·∫≠n
	  operator: "Equal" 		‚Üí ƒêi·ªÅu ki·ªán kh·ªõp ch√≠nh x√°c
	  value: "true" 			‚Üí Gi√° tr·ªã c·∫ßn kh·ªõp
	  effect: "NoExecute" 		‚Üí T√°c ƒë·ªông: Kh√¥ng l√™n l·ªãch (NoSchedule) ho·∫∑c ƒëu·ªïi kh·ªèi node (NoExecute)

	SECURITYCONTEXT: 			‚Üí THI·∫æT L·∫¨P B·∫¢O M·∫¨T ·ªû C·∫§P ƒê·ªò POD	
	  runAsUser: 1000 			‚Üí Ch·∫°y container d∆∞·ªõi user ID n√†y
	  runAsGroup: 3000 			‚Üí Ch·∫°y container d∆∞·ªõi group ID n√†y
	  fsGroup: 2000 			‚Üí Nh√≥m s·ªü h·ªØu volumes ƒë√£ g·∫Øn k·∫øt

	INITCONTAINERS: 			‚Üí CH·∫†Y TR∆Ø·ªöC KHI CONTAINER CH√çNH CH·∫†Y
	- name: init-techops 		‚Üí T√™n container kh·ªüi t·∫°o
	  image: busybox 			‚Üí Image c·ªßa container kh·ªüi t·∫°o
	  command: ["sh", "-c", "echo Init; sleep 5"] 	‚Üí C√¢u l·ªánh kh·ªüi t·∫°o
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
H·ªá sinh th√°i g·∫ßn ho√†n ch·ªânh:
	- 1. kiali
	- 2. bookInfo - bookStore
	- 3. rancher
	- 4. grafana - istio
	- 5. argocd
	
Cheat Sheet: H·ªá Th·ªëng Thi·∫øt K·∫ø (System Design)
System  design l√† qu√° tr√¨nh x√¢y d·ª±ng c√°c ·ª©ng d·ª•ng c√≥ th·ªÉ ƒë√°p ·ª©ng nhu c·∫ßu th·ª±c  t·∫ø v·ªõi kh·∫£ nƒÉng m·ªü r·ªông, hi·ªáu su·∫•t cao v√† b·∫£o m·∫≠t t·ªët. 
D∆∞·ªõi ƒë√¢y l√† nh·ªØng th√†nh ph·∫ßn c·ªët l√µi b·∫°n c·∫ßn n·∫Øm r√µ khi thi·∫øt k·∫ø h·ªá th·ªëng.
üìå M·∫°ng & K·∫øt N·ªëi (Networking)
	DNS (Domain Name System): H·ªá th·ªëng ph√¢n gi·∫£i t√™n mi·ªÅn (resolvers, nameservers, records)
	Load Balancers: C√¢n b·∫±ng t·∫£i ·ªü Layer 4, Layer 7 (ph·∫ßn c·ª©ng, ph·∫ßn m·ªÅm)
	CDNs (Content Delivery Networks): M·∫°ng ph√¢n ph·ªëi n·ªôi dung (caching, edge servers)
	Proxies: Proxy chuy·ªÉn ti·∫øp, proxy ng∆∞·ª£c, proxy ·∫©n danh
	VPNs (Virtual Private Networks): M·∫°ng ri√™ng ·∫£o, giao th·ª©c ƒë∆∞·ªùng h·∫ßm
	Firewalls: T∆∞·ªùng l·ª≠a (l·ªçc g√≥i tin, ki·ªÉm tra tr·∫°ng th√°i)
	NAT (Network Address Translation): Bi√™n d·ªãch ƒë·ªãa ch·ªâ m·∫°ng
	Gateways: K·∫øt n·ªëi c√°c m·∫°ng kh√°c nhau
	Routers: ƒê·ªãnh tuy·∫øn l∆∞u l∆∞·ª£ng gi·ªØa c√°c m·∫°ng
üìå L∆∞u Tr·ªØ (Storage)
	Databases: SQL, NoSQL (key-value, document, columnar, graph), NewSQL
	Object Storage: Amazon S3, Google Cloud Storage, Azure Blob Storage
	Block Storage: NAS (Network-attached storage), SAN (Storage area networks)
	File Systems: H·ªá th·ªëng file ph√¢n t√°n (HDFS, Ceph), NFS (Network File System)
	Caching: Redis, Memcached, Varnish, CDN edge caches
üìå X·ª≠ L√Ω (Compute)
	Servers: M√°y ch·ªß v·∫≠t l√Ω (bare metal), m√°y ·∫£o (VMs)
	Containers: Docker, Kubernetes, container orchestration
	Serverless: AWS Lambda, Azure Functions, Google Cloud Functions
	FaaS (Function-as-a-Service): D·ªãch v·ª• serverless d√†nh cho ch·ª©c nƒÉng nh·ªè
	PaaS (Platform-as-a-Service): N·ªÅn t·∫£ng ƒëi·ªán to√°n ƒë√°m m√¢y
üìå Giao Ti·∫øp (Communication)
	APIs: REST, GraphQL, SOAP, gRPC
	Message Queues: RabbitMQ, Kafka, ActiveMQ, Amazon SQS
	WebSockets: Giao ti·∫øp th·ªùi gian th·ª±c, full-duplex
	RPC (Remote Procedure Call): XML-RPC, JSON-RPC
	Pub/Sub (Publish-Subscribe): M√¥ h√¨nh giao ti·∫øp theo ki·ªÉu ƒëƒÉng k√Ω - xu·∫•t b·∫£n
	Service Mesh: Istio, Linkerd (qu·∫£n l√Ω giao ti·∫øp gi·ªØa microservices)
üìå Ki·∫øn Tr√∫c H·ªá Th·ªëng (Architectural Patterns)
	Microservices: Thi·∫øt k·∫ø h∆∞·ªõng domain (DDD), service discovery, API gateways
	Monolithic: Ki·∫øn tr√∫c nguy√™n kh·ªëi, MVC, MVP
	Event-driven: Event sourcing, CQRS
	Serverless: FaaS, BaaS (Backend-as-a-Service)
üìå Kh·∫£ NƒÉng M·ªü R·ªông & ƒê·ªô Tin C·∫≠y (Scalability & Reliability)
	Horizontal Scaling: M·ªü r·ªông theo chi·ªÅu ngang (th√™m m√°y ch·ªß, auto-scaling)
	Vertical Scaling: M·ªü r·ªông theo chi·ªÅu d·ªçc (n√¢ng c·∫•p t√†i nguy√™n m√°y ch·ªß)
	Replication: Master-slave, master-master
	Sharding: Chia nh·ªè d·ªØ li·ªáu ƒë·ªÉ tƒÉng hi·ªáu su·∫•t
	Redundancy: D·ª± ph√≤ng nhi·ªÅu m√°y ch·ªß, c∆° ch·∫ø failover
	Fault Tolerance: C∆° ch·∫ø gi·∫£m thi·ªÉu l·ªói (circuit breakers, graceful degradation)
	Disaster Recovery: Sao l∆∞u, nh√¢n b·∫£n, ph√¢n t√°n ƒë·ªãa l√Ω
üìå B·∫£o M·∫≠t (Security)
	Authentication: X√°c th·ª±c (MFA, SSO, OAuth, OpenID Connect)
	Authorization: Ph√¢n quy·ªÅn (RBAC - Role-based access control)
	Encryption: M√£ h√≥a ƒë·ªëi x·ª©ng, b·∫•t ƒë·ªëi x·ª©ng, bƒÉm d·ªØ li·ªáu
	Security Protocols: TLS/SSL, HTTPS, SSH
	Web Application Firewalls: B·∫£o v·ªá tr∆∞·ªõc c√°c cu·ªôc t·∫•n c√¥ng web
	Intrusion Detection Systems: H·ªá th·ªëng ph√°t hi·ªán x√¢m nh·∫≠p
üìå Quan S√°t & Gi√°m S√°t (Observability)
	Monitoring: Gi√°m s√°t (Prometheus, Grafana, Datadog, New Relic)
	Logging: Ghi log (ELK Stack - Elasticsearch, Logstash, Kibana, Splunk)
	Tracing: Theo d√µi truy v·∫øt h·ªá th·ªëng (Jaeger, Zipkin)
	Metrics: Ch·ªâ s·ªë ƒëo l∆∞·ªùng (counters, gauges, histograms, summaries)
Cre: Mayank Ahuja
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
No one really spelled out how to fix this.
Here is what I did

My env:

Private docker registry on separate host. No password, using port 443
Private openssl CA.
Generate certs for each node (workers and masters). need public key, private key (unencrypted), and your root ca's public key (Openssl CA public key). I created a Subject Alternative Name (SAN) value for short hostname, FQDN, and IP address for each.
On each node create /etc/docker/certs.d/ (If it does not exist create it)
cd /etc/docker/certs.d/, create a directory in here that uses the SAME EXACT name used when you communicate with the registry in your manifest. So if you are referecing "docker-reg.company.domain" directory must say that. Or if you use "docker-reg.company.domain:443", need to make the directory name include the port. Must be exact as you reference in your mainfest.
Copy your RootCA, public key, and private key to this directory. They must be this name structure.
root ca = ca.crt
public key = client.cert
private key = client.key
Copy the root ca public key also to the cert store for the OS
Debian / Ubuntu
cp certs/domain.crt /usr/local/share/ca-certificates/myregistrydomain.com.crt
update-ca-certificates
Rhel / Centos
cp certs/domain.crt /etc/pki/ca-trust/source/anchors/myregistrydomain.com.crt
update-ca-trust

Test to make sure you can pull directly from the node with docker pull docker-reg.company.domain:443/my-image:latest (Or however you have it in your manifest, must be exact)
If all this is done correctly try doing a deployment with kubectl again. Be careful of namespaces.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
wget https://letsencrypt.org/certs/staging/letsencrypt-stg-int-r3.pem
wget https://letsencrypt.org/certs/staging/letsencrypt-stg-root-x1.pem

echo ‚ÄúCreating secret with let‚Äôs encrypt certs for rancher agent pod‚Äù
kubectl -n cattle-system create configmap ca-pemstore --from-file=letsencrypt-stg-root-x1.pem --from-file=letsencrypt-stg-int-r3.pem

echo ‚Äú### patching rancher agent deployment‚Ä¶‚Äù
echo ‚Äú### adding volume from configmap with let‚Äôs encrypt certs‚Äù
kubectl -n cattle-system get deployment cattle-cluster-agent -o json | jq ‚Äò.spec.template.spec.volumes += [{‚Äúname‚Äù: ‚Äúca-pemstore‚Äù, configMap: {‚Äúname‚Äù: ‚Äúca-pemstore‚Äù} }]‚Äô | kubectl replace -f -
sleep 1
echo ‚Äú### Mounting volume with cert‚Äù
kubectl -n cattle-system get deployment cattle-cluster-agent -o json | jq ‚Äò.spec.template.spec.containers[0].volumeMounts += [{‚Äúname‚Äù: ‚Äúca-pemstore‚Äù,‚ÄúmountPath‚Äù: ‚Äú/usr/local/share/ca-certificates/letsencrypt-stg-root-x1.crt‚Äù,‚ÄúsubPath‚Äù: ‚Äúletsencrypt-stg-root-x1.pem‚Äù,‚ÄúreadOnly‚Äù: false}]‚Äô | kubectl replace -f -
sleep 1
echo ‚Äú### Adding postStart action to update system wide certificates‚Äù
kubectl -n cattle-system get deployment cattle-cluster-agent -o json | jq ‚Äò.spec.template.spec.containers[0].lifecycle.postStart.exec.command = [ ‚Äú/usr/sbin/update-ca-certificates‚Äù]‚Äô | kubectl replace -f -
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
- M√¥ h√¨nh CI/CD:
	- TCB:
		+ Team: 		Sec - Vault			Ops - System		 Dev - Code
		+ Tool CI/CD:	jenkins - ansible
		+ Repo:			gitlab
		+ 1 t√†i kho·∫£n ƒë·∫∑c quy·ªÅn v·ªõi full quy·ªÅn t√°c ƒë·ªông l√™n server, tkdq nh·∫≠p use/path l√™n vault path, pass chia 2 n·ª≠a, sec g√µ 1 n·ª≠a, ops g√µ 1 n·ª≠a, sau khi nh·∫≠p xong th√¨ sec/ops ch·ªâ bi·∫øt l√† c√≥ c√°i path ƒë√≥, ko bi·∫øt pass l√† j.
		+ Dev code & commit tr√™n repo dev -> sau 30'-1h repo dev ƒëc sync ƒë·∫øn repo prod, ops c≈©ng vi·∫øt pipeline ƒë·ªÉ cicd cho app v√† commit nh∆∞ v·∫≠y.
		+ trong pipeline, ops define url vault, path vault, trong jenkins ops define credential vault -> ƒë·∫øn ng√†y golive th√¨ ch·∫°y
		
		+ 

- gitops: s·ª≠ d·ª•ng k·∫øt h·ª£p v·ªõi Vault, ko l∆∞u secret trong git.
- kyverno: x·ª≠ l√Ω ph√¢n quy·ªÅn
- Vault: qu·∫£n l√Ω secret t·∫≠p trung, edit/update secret -> ko c√≥ quy·ªÅn v√†o Vault th√¨ ko xem ƒëc
	+ ks8 load secret by Agent -> ph√¢n quy·ªÅn xem secret
	+ gitlab: save path of secret on Vault, ko ƒëc khai b√°o secret tr·ª±c ti·∫øp
	
	+ n·∫øu k s·ª≠ d·ª•ng Vault, khi agent inject secret v√†o pod th√¨ secret s·∫Ω l√† env var/file, b·∫•t c·ª© ai c√≥ quy·ªÅn exec pod c≈©ng xem ƒëc secret (maintainer) -> d√πng Vault
		- if not Vault: xxx
	+ Gitlab-CI:
		+ save value of Vault
		+ c·∫ßn x√°c th·ª±c (user, pass) ƒë·∫øn Vault r·ªìi m·ªõi pull value v·ªÅ ƒë∆∞·ª£c.
		-> d√πng gitlab-secret
	+ Jenkins: define secret trong credential
		
- Security:
	+ Quy tr√¨nh use, save credential, ph√¢n quy·ªÅn, qu·∫£n l√Ω ntn:
		- credential save on Vault, chia 2 n·ª≠a, ops 1 n·ª≠a, sec 1 n·ª≠a
		- khai b√°o secret v√†o helm/manifest, path l√† url tr√™n vault, ƒë√£ g·ªìm 2 n·ª≠a tr√™n kia
	+ QT1:
		- Cluster: 	d√πng RBAC gi·ªõi h·∫°n quy·ªÅn c·ªßa user, cho ph√©p user/group c√≥ quy·ªÅn j v·ªõi secret/pro/deployment
		- k8s:		c≈©ng c·∫ßn ph√¢n quy·ªÅn pod, ..., ko ph·∫£i ai c≈©ng c√≥ th·ªÉ xem secret hay exec pod ƒëc
		
	
	+ Secrets Store CSI Driver: k·∫øt h·ª£p vs Dev + RBAC ƒë·ªÉ ph√¢n quy·ªÅn cho api k8s
- Migrate DB:
	+ 
	+ 
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Ubuntu Alias
- Temporarily alias:	alias alias_name='aliased_command --options'	-> 	unalias alias_name
- Permanent alias:		alias alias_name='aliased_command --options'
	+ save to system file: /.bashrc	or	/.alias
	+ save user file:	/.alias need add script to /.bashrc					-> source /.bashrc OR . /bashrc: k√≠ch ho·∫°t alias ngay
		if [ -e $HOME/.alias ]; then [ -n "$PS1" ] && . $HOME/.alias; fi
- alias: xem alisas [permanent  + temporarily]
// alias in Linux
alias ai='sudo apt-get install'
alias ar='sudo apt-get remove'
alias au='sudo apt-get update'
alias aug='sudo apt-get upgrade

alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias du='du -h'			// du -sh path		du -h -d 1 path
alias df='df -h'
alias l.='ls -d .* --color=auto'
alias ls='ls -F --color=auto'
alias cl='clear && ls'		#X√≥a m√†n h√¨nh v√† hi·ªÉn th·ªã file, th∆∞ m·ª•c con

alias e='exit'
alias s='sudo'
alias nnb='nano ~/.bashrc'  #S·ª≠a file alias
alias rlb='. ~/.bashrc'		#Load l·∫°i file alias
alias h='history'

// alias in git:			git config --get-regexp alias		// check alias of git
git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.ci commit
git config --global alias.st status
git config --global alias.last 'log -1 HEAD'

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

